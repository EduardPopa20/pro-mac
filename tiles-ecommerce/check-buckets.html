<!DOCTYPE html>
<html>
<head>
    <title>Check Supabase Storage Buckets</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h2>Supabase Storage Bucket Test</h2>
    <div id="results"></div>
    
    <script>
        const supabaseUrl = 'https://mgmpsxgeoobohsfrgbai.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nbXBzeGdlb29ib2hzZnJnYmFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMjg0MDIsImV4cCI6MjA3MTkwNDQwMn0.NfzeySliIQOsWXeDrdEvpjIu69f_rgpunIVc-D6knA4'
        
        const supabase = supabase.createClient(supabaseUrl, supabaseKey)
        
        async function checkBuckets() {
            const resultsDiv = document.getElementById('results')
            
            try {
                // List all buckets
                const { data: buckets, error } = await supabase.storage.listBuckets()
                
                if (error) {
                    resultsDiv.innerHTML = `<p style="color: red;">‚ùå Error listing buckets: ${error.message}</p>`
                    return
                }
                
                let html = '<h3>üì¶ Available Buckets:</h3><ul>'
                
                if (buckets && buckets.length > 0) {
                    buckets.forEach(bucket => {
                        html += `<li><strong>${bucket.name}</strong> - Public: ${bucket.public}, Created: ${bucket.created_at}</li>`
                    })
                } else {
                    html += '<li>No buckets found</li>'
                }
                
                html += '</ul>'
                
                // Check specifically for product-images bucket
                const productImagesBucket = buckets?.find(b => b.name === 'product-images')
                
                if (productImagesBucket) {
                    html += '<p style="color: green;">‚úÖ product-images bucket exists!</p>'
                    
                    // Test upload to the bucket
                    const testFile = new Blob(['test content'], { type: 'text/plain' })
                    const testFileName = `test-${Date.now()}.txt`
                    
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('product-images')
                        .upload(`temp/${testFileName}`, testFile)
                    
                    if (uploadError) {
                        html += `<p style="color: orange;">‚ö†Ô∏è Upload test failed: ${uploadError.message}</p>`
                    } else {
                        html += '<p style="color: green;">‚úÖ Upload test successful!</p>'
                        
                        // Clean up test file
                        await supabase.storage
                            .from('product-images')
                            .remove([`temp/${testFileName}`])
                        
                        html += '<p>üßπ Test file cleaned up</p>'
                    }
                } else {
                    html += '<p style="color: red;">‚ùå product-images bucket NOT found</p>'
                    html += '<p>You need to create a bucket named "product-images" in the Supabase Dashboard</p>'
                }
                
                resultsDiv.innerHTML = html
                
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">‚ùå Unexpected error: ${error.message}</p>`
            }
        }
        
        // Run the test when page loads
        checkBuckets()
    </script>
</body>
</html>